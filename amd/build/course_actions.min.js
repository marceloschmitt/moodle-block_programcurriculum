define(["core/notification","core/modal_delete_cancel","core/modal_events","core/str"],function(c,i,m,s){function e(){function n(e,t){a&&(e=a.elements.namedItem(e))&&(e.value=t)}document.querySelectorAll("a[data-confirm-message]").forEach(function(o){"1"!==o.dataset.confirmBound&&(o.dataset.confirmBound="1",o.addEventListener("click",function(e){e.preventDefault();var e=o.getAttribute("data-confirm-message")||"",t=o.getAttribute("data-confirm-name")||"";(t?s.get_strings([{key:"deletecoursetitle",component:"block_programcurriculum"},{key:"deletecoursebody",component:"block_programcurriculum",param:t}]).then(function(e){return i.create({title:e[0],body:e[1]}).then(function(e){function t(){window.location.href=o.href}var n=e.getRoot();return n.on(m.save,t),n.on(m.delete,t),e.show(),e})}):i.create({title:e,body:""}).then(function(e){function t(){window.location.href=o.href}var n=e.getRoot();return n.on(m.save,t),n.on(m.delete,t),e.show(),e})).catch(c.exception)}))});var u,d,l=document.querySelector(".programcurriculum-course[data-curriculum-id]"),o=(l&&!l.dataset.moveBound&&(l.dataset.moveBound="1",parseInt(l.getAttribute("data-curriculum-id")||"0",10),l.getAttribute("data-sesskey"),u=[],d=function(){u.forEach(function(e){e.parentNode&&e.parentNode.removeChild(e)}),u=[],l.classList.remove("programcurriculum-move-mode");var e=l.querySelector(".programcurriculum-move-cancel");e&&e.remove()},l.addEventListener("click",function(e){var t,o,n,r,a,c,i=e.target.closest(".programcurriculum-move-trigger");i&&(e.preventDefault(),e.stopPropagation(),e=i.getAttribute("data-move-course-id"),t=i.getAttribute("data-move-target")||i.getAttribute("data-move-url")||"",i.getAttribute("data-move-name"),e)&&t&&(o=t,d(),l.classList.add("programcurriculum-move-mode"),(i=document.createElement("div")).className="alert alert-info programcurriculum-move-cancel d-flex align-items-center justify-content-between",r=document.createElement("span"),(a=document.createElement("button")).type="button",a.className="btn btn-sm btn-outline-secondary",a.addEventListener("click",d),s.get_string("movepositionclick","block_programcurriculum").then(function(e){r.textContent=e}).catch(function(){r.textContent="Click on a dashed line to move to that position."}),s.get_string("cancel","moodle").then(function(e){a.textContent=e}).catch(function(){a.textContent="Cancel"}),i.appendChild(r),i.appendChild(a),(e=l.querySelector(".mb-4"))?l.insertBefore(i,e):l.appendChild(i),(c=Array.from(l.querySelectorAll(".programcurriculum-course-item"))).forEach(function(e,t){var n=document.createElement("li");n.className="programcurriculum-move-placeholder",n.setAttribute("data-position",String(t+1)),n.setAttribute("role","button"),n.setAttribute("tabindex","0"),n.setAttribute("aria-label","Mover para posição "+(t+1)),n.addEventListener("click",function(){var e=parseInt(n.getAttribute("data-position"),10),e=o+(0<=o.indexOf("?")?"&":"?")+"position="+e;window.location.href=e}),n.addEventListener("keydown",function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),n.click())}),e.parentNode.insertBefore(n,e),u.push(n)}),e=c[c.length-1])&&((n=document.createElement("li")).className="programcurriculum-move-placeholder",n.setAttribute("data-position",String(c.length+1)),n.setAttribute("role","button"),n.setAttribute("tabindex","0"),n.setAttribute("aria-label","Mover para posição "+(c.length+1)),n.addEventListener("click",function(){var e=o+(0<=o.indexOf("?")?"&":"?")+"position="+(c.length+1);window.location.href=e}),n.addEventListener("keydown",function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),n.click())}),e.parentNode.appendChild(n),u.push(n))})),document.querySelector('[data-open-course-modal="1"]')),r=document.getElementById("programcurriculum-course-modal-title"),a=document.getElementById("programcurriculum-course-form"),e=document.querySelector('[data-action="add-course"]');e&&!e.dataset.modalBound&&(e.dataset.modalBound="1",e.addEventListener("click",function(){r&&(r.textContent=r.dataset.addTitle||r.textContent),n("id",0),n("name",""),n("externalcode",""),n("sortorder",0),n("term",1)})),document.querySelectorAll('a[data-action="edit-course"]').forEach(function(t){"1"!==t.dataset.modalBound&&(t.dataset.modalBound="1",t.addEventListener("click",function(e){e.preventDefault(),r&&(r.textContent=r.dataset.editTitle||r.textContent),n("id",t.dataset.editId||0),n("name",t.dataset.editName||""),n("externalcode",t.dataset.editCode||""),n("sortorder",t.dataset.editSortorder||0),n("term",t.dataset.editTerm||1),n("curriculumid",t.dataset.editCurriculum||0),o&&o.click()}))})}return{init:function(){e()}}});