define(["core/notification","core/modal_delete_cancel","core/modal_events","core/str"],function(i,m,s,f){function e(){function r(e,t){c&&(e=c.elements.namedItem(e))&&(e.value=t)}document.querySelectorAll("a[data-confirm-message]").forEach(function(o){"1"!==o.dataset.confirmBound&&(o.dataset.confirmBound="1",o.addEventListener("click",function(e){e.preventDefault();var e=o.getAttribute("data-confirm-message")||"",t=o.getAttribute("data-confirm-name")||"";(t?f.get_strings([{key:"deletecoursetitle",component:"block_programcurriculum"},{key:"deletecoursebody",component:"block_programcurriculum",param:t}]).then(function(e){return m.create({title:e[0],body:e[1]}).then(function(e){function t(){window.location.href=o.href}var r=e.getRoot();return r.on(s.save,t),r.on(s.delete,t),e.show(),e})}):m.create({title:e,body:""}).then(function(e){function t(){window.location.href=o.href}var r=e.getRoot();return r.on(s.save,t),r.on(s.delete,t),e.show(),e})).catch(i.exception)}))});var u,d,o,l=document.querySelector(".programcurriculum-course[data-curriculum-id]"),n=(l&&!l.dataset.moveBound&&(l.dataset.moveBound="1",parseInt(l.getAttribute("data-curriculum-id")||"0",10),l.getAttribute("data-sesskey"),u=[],d=function(){u.forEach(function(e){e.parentNode&&e.parentNode.removeChild(e)}),u=[],l.classList.remove("programcurriculum-move-mode");var e=l.querySelector(".programcurriculum-move-cancel");e&&e.remove()},o=function(e,n,t){d(),l.classList.add("programcurriculum-move-mode");function a(t,r,e){var o=document.createElement("li");return o.className="programcurriculum-move-placeholder",o.setAttribute("data-before-id",String(t||0)),o.setAttribute("data-term",String(r||1)),o.setAttribute("role","button"),o.setAttribute("tabindex","0"),o.setAttribute("aria-label",e||"Mover"),o.addEventListener("click",function(){var e=0<=n.indexOf("?")?"&":"?";window.location.href=n+e+"before="+(t||0)+"&targetterm="+(r||1)}),o.addEventListener("keydown",function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),o.click())}),o}var r=document.createElement("div"),o=(r.className="alert alert-info programcurriculum-move-cancel d-flex align-items-center justify-content-between",document.createElement("span")),c=document.createElement("button"),i=(c.type="button",c.className="btn btn-sm btn-outline-secondary",c.addEventListener("click",d),f.get_string("movepositionclick","block_programcurriculum").then(function(e){o.textContent=e}).catch(function(){o.textContent="Click on a dashed line to move to that position."}),f.get_string("cancel","moodle").then(function(e){c.textContent=e}).catch(function(){c.textContent="Cancel"}),r.appendChild(o),r.appendChild(c),l.querySelector(".mb-4")),i=(i?l.insertBefore(r,i):l.appendChild(r),Array.from(l.querySelectorAll(".programcurriculum-term-section")));i.forEach(function(e){var t,r=e.querySelector(".programcurriculum-term-list"),o=parseInt(e.getAttribute("data-term")||"1",10),e=e.querySelectorAll(".programcurriculum-course-item");0<e.length?(e.forEach(function(e){var t=e.getAttribute("data-course-id"),t=a(t,o,"Mover para posição");e.parentNode.insertBefore(t,e),u.push(t)}),t=a(0,o,"Mover para final"),e[e.length-1].parentNode.appendChild(t),u.push(t)):(e=a(0,o,"Mover para este período"),r.insertBefore(e,r.firstChild),u.push(e))})},l.addEventListener("click",function(e){var t,r=e.target.closest(".programcurriculum-move-trigger");r&&(e.preventDefault(),e.stopPropagation(),e=r.getAttribute("data-move-course-id"),t=r.getAttribute("data-move-target")||r.getAttribute("data-move-url")||"",r.getAttribute("data-move-name"),e)&&t&&o(0,t)})),document.querySelector('[data-open-course-modal="1"]')),a=document.getElementById("programcurriculum-course-modal-title"),c=document.getElementById("programcurriculum-course-form"),e=document.querySelector('[data-action="add-course"]');e&&!e.dataset.modalBound&&(e.dataset.modalBound="1",e.addEventListener("click",function(){a&&(a.textContent=a.dataset.addTitle||a.textContent),r("id",0),r("name",""),r("externalcode",""),r("equivalencecode",""),r("sortorder",0),r("term",1)})),document.querySelectorAll('a[data-action="edit-course"]').forEach(function(t){"1"!==t.dataset.modalBound&&(t.dataset.modalBound="1",t.addEventListener("click",function(e){e.preventDefault(),a&&(a.textContent=a.dataset.editTitle||a.textContent),r("id",t.dataset.editId||0),r("name",t.dataset.editName||""),r("externalcode",t.dataset.editCode||""),r("equivalencecode",t.dataset.editEquivalencecode||""),r("sortorder",t.dataset.editSortorder||0),r("term",t.dataset.editTerm||1),r("curriculumid",t.dataset.editCurriculum||0),n&&n.click()}))})}return{init:function(){e()}}});