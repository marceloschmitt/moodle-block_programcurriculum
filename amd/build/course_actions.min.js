define(["core/notification","core/modal_delete_cancel","core/modal_events","core/str"],function(i,u,s,f){function e(){function r(e,t){c&&(e=c.elements.namedItem(e))&&(e.value=t)}document.querySelectorAll("a[data-confirm-message]").forEach(function(o){"1"!==o.dataset.confirmBound&&(o.dataset.confirmBound="1",o.addEventListener("click",function(e){e.preventDefault();var e=o.getAttribute("data-confirm-message")||"",t=o.getAttribute("data-confirm-name")||"";(t?f.get_strings([{key:"deletecoursetitle",component:"block_programcurriculum"},{key:"deletecoursebody",component:"block_programcurriculum",param:t}]).then(function(e){return u.create({title:e[0],body:e[1]}).then(function(e){function t(){window.location.href=o.href}var r=e.getRoot();return r.on(s.save,t),r.on(s.delete,t),e.show(),e})}):u.create({title:e,body:""}).then(function(e){function t(){window.location.href=o.href}var r=e.getRoot();return r.on(s.save,t),r.on(s.delete,t),e.show(),e})).catch(i.exception)}))});var d,l,o,m=document.querySelector(".programcurriculum-course[data-curriculum-id]"),n=(m&&!m.dataset.moveBound&&(m.dataset.moveBound="1",parseInt(m.getAttribute("data-curriculum-id")||"0",10),m.getAttribute("data-sesskey"),d=[],l=function(){d.forEach(function(e){e.parentNode&&e.parentNode.removeChild(e)}),d=[],m.classList.remove("programcurriculum-move-mode");var e=m.querySelector(".programcurriculum-move-cancel");e&&e.remove()},o=function(e,o,t){l(),m.classList.add("programcurriculum-move-mode");function n(t){var r=document.createElement("li");return r.className="programcurriculum-move-placeholder",r.setAttribute("data-position",String(t)),r.setAttribute("role","button"),r.setAttribute("tabindex","0"),r.setAttribute("aria-label","Mover para posição "+t),r.addEventListener("click",function(){var e=o+(0<=o.indexOf("?")?"&":"?")+"position="+t;window.location.href=e}),r.addEventListener("keydown",function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),r.click())}),r}var r=document.createElement("div"),a=(r.className="alert alert-info programcurriculum-move-cancel d-flex align-items-center justify-content-between",document.createElement("span")),c=document.createElement("button"),i=(c.type="button",c.className="btn btn-sm btn-outline-secondary",c.addEventListener("click",l),f.get_string("movepositionclick","block_programcurriculum").then(function(e){a.textContent=e}).catch(function(){a.textContent="Click on a dashed line to move to that position."}),f.get_string("cancel","moodle").then(function(e){c.textContent=e}).catch(function(){c.textContent="Cancel"}),r.appendChild(a),r.appendChild(c),m.querySelector(".mb-4")),i=(i?m.insertBefore(r,i):m.appendChild(r),Array.from(m.querySelectorAll(".programcurriculum-term-section"))),u=1;i.forEach(function(e){var t,r=e.querySelector(".programcurriculum-term-list"),e=e.querySelectorAll(".programcurriculum-course-item");0===e.length?(t=n(u),r.insertBefore(t,r.firstChild),d.push(t)):(e.forEach(function(e){var t=n(u);e.parentNode.insertBefore(t,e),d.push(t),u+=1}),r=n(u),e[e.length-1].parentNode.appendChild(r),d.push(r)),u+=1})},m.addEventListener("click",function(e){var t,r=e.target.closest(".programcurriculum-move-trigger");r&&(e.preventDefault(),e.stopPropagation(),e=r.getAttribute("data-move-course-id"),t=r.getAttribute("data-move-target")||r.getAttribute("data-move-url")||"",r.getAttribute("data-move-name"),e)&&t&&o(0,t)})),document.querySelector('[data-open-course-modal="1"]')),a=document.getElementById("programcurriculum-course-modal-title"),c=document.getElementById("programcurriculum-course-form"),e=document.querySelector('[data-action="add-course"]');e&&!e.dataset.modalBound&&(e.dataset.modalBound="1",e.addEventListener("click",function(){a&&(a.textContent=a.dataset.addTitle||a.textContent),r("id",0),r("name",""),r("externalcode",""),r("sortorder",0),r("term",1)})),document.querySelectorAll('a[data-action="edit-course"]').forEach(function(t){"1"!==t.dataset.modalBound&&(t.dataset.modalBound="1",t.addEventListener("click",function(e){e.preventDefault(),a&&(a.textContent=a.dataset.editTitle||a.textContent),r("id",t.dataset.editId||0),r("name",t.dataset.editName||""),r("externalcode",t.dataset.editCode||""),r("sortorder",t.dataset.editSortorder||0),r("term",t.dataset.editTerm||1),r("curriculumid",t.dataset.editCurriculum||0),n&&n.click()}))})}return{init:function(){e()}}});